# Use an official Python runtime as a parent image
FROM python:3.12-slim

# Set the working directory in the container
WORKDIR /app

# Copy requirements file
COPY requirements.txt ./

# Install Python dependencies
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt && \
    pip install --no-cache-dir PyPDF2 pandas beautifulsoup4 aiohttp watchdog fuzzywuzzy chardet anthropic

# Copy the data_processors directory
COPY . /app/data_processors

# Create the necessary directories for file ingestion
RUN mkdir -p /data_ingestion/inbox/pdfs \
    /data_ingestion/inbox/csvs \
    /data_ingestion/inbox/articles \
    /data_ingestion/processing \
    /data_ingestion/completed \
    /data_ingestion/failed \
    /data_ingestion/logs

# Set environment variables
ENV PYTHONPATH=/app
ENV DATA_INGESTION_PATH=/data_ingestion

# Run the file watcher service
CMD ["python", "-m", "data_processors.src.taifa_etl.services.file_ingestion.cli.file_ingestion_cli", "watch"]