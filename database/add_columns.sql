-- TAIFA-FIALA Database Schema (Updated)
-- This file contains the complete schema matching the SQLAlchemy models
-- Execute this in the Supabase SQL Editor

-- Health check table for testing connectivity
CREATE TABLE IF NOT EXISTS health_check (
    id SERIAL PRIMARY KEY,
        status VARCHAR(50) DEFAULT 'OK',
            checked_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
            );
            
            INSERT INTO health_check (status) VALUES ('OK');
            
            -- Geographic scopes reference table
            CREATE TABLE IF NOT EXISTS geographic_scopes (
                id SERIAL PRIMARY KEY,
                    name TEXT NOT NULL,
                        code VARCHAR(10),
                            region TEXT,
                                description TEXT,
                                    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                        updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                        );
                                        
                                        -- AI domains reference table
                                        CREATE TABLE IF NOT EXISTS ai_domains (
                                            id SERIAL PRIMARY KEY,
                                                name TEXT NOT NULL,
                                                    description TEXT,
                                                        parent_id INTEGER REFERENCES ai_domains(id),
                                                            created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                );
                                                                
                                                                -- Community users table
                                                                CREATE TABLE IF NOT EXISTS community_users (
                                                                    id SERIAL PRIMARY KEY,
                                                                        username VARCHAR(100) NOT NULL,
                                                                            email VARCHAR(255) NOT NULL UNIQUE,
                                                                                created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                    );
                                                                                    
                                                                                    -- Organizations table with role distinctions
                                                                                    CREATE TABLE IF NOT EXISTS organizations (
                                                                                        id SERIAL PRIMARY KEY,
                                                                                            name VARCHAR(300) NOT NULL,
                                                                                                type VARCHAR(20) DEFAULT 'funder',
                                                                                                    
                                                                                                        -- Organization role fields
                                                                                                            role VARCHAR(20) DEFAULT 'provider',
                                                                                                                provider_type VARCHAR(20),
                                                                                                                    recipient_type VARCHAR(20),
                                                                                                                        
                                                                                                                            -- Stage classification for startups
                                                                                                                                startup_stage VARCHAR(30),
                                                                                                                                    
                                                                                                                                        -- Funding classification for providers
                                                                                                                                            funding_model VARCHAR(30),
                                                                                                                                                
                                                                                                                                                    -- Contact and location
                                                                                                                                                        country VARCHAR(100),
                                                                                                                                                            region VARCHAR(100),
                                                                                                                                                                website VARCHAR(500),
                                                                                                                                                                    email VARCHAR(200),
                                                                                                                                                                        description TEXT,
                                                                                                                                                                            
                                                                                                                                                                                -- Enhanced organization profile
                                                                                                                                                                                    contact_person VARCHAR(255),
                                                                                                                                                                                        contact_email VARCHAR(255),
                                                                                                                                                                                            
                                                                                                                                                                                                -- Funding characteristics
                                                                                                                                                                                                    funding_capacity VARCHAR(50),
                                                                                                                                                                                                        focus_areas TEXT,
                                                                                                                                                                                                            established_year INTEGER,
                                                                                                                                                                                                                
                                                                                                                                                                                                                    -- AI and Africa relevance scoring
                                                                                                                                                                                                                        ai_relevance_score INTEGER DEFAULT 0,
                                                                                                                                                                                                                            africa_relevance_score INTEGER DEFAULT 0,
                                                                                                                                                                                                                                
                                                                                                                                                                                                                                    -- Monitoring configuration
                                                                                                                                                                                                                                        source_type VARCHAR(20) DEFAULT 'manual',
                                                                                                                                                                                                                                            update_frequency VARCHAR(20),
                                                                                                                                                                                                                                                funding_announcement_url TEXT,
                                                                                                                                                                                                                                                    monitoring_status VARCHAR(20) DEFAULT 'active',
                                                                                                                                                                                                                                                        monitoring_reliability INTEGER DEFAULT 100,
                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                -- Performance metrics
                                                                                                                                                                                                                                                                    opportunities_discovered INTEGER DEFAULT 0,
                                                                                                                                                                                                                                                                        unique_opportunities_added INTEGER DEFAULT 0,
                                                                                                                                                                                                                                                                            duplicate_rate INTEGER DEFAULT 0,
                                                                                                                                                                                                                                                                                data_completeness_score INTEGER DEFAULT 0,
                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                        -- Community features
                                                                                                                                                                                                                                                                                            community_rating NUMERIC(2,1),
                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                    -- Equity and inclusion tracking
                                                                                                                                                                                                                                                                                                        women_led BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                            underrepresented_led BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                inclusion_details JSONB,
                                                                                                                                                                                                                                                                                                                    equity_score FLOAT,
                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                            -- Status and timestamps
                                                                                                                                                                                                                                                                                                                                is_active BOOLEAN DEFAULT TRUE,
                                                                                                                                                                                                                                                                                                                                    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                        updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                        -- Indexes for organizations
                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_organizations_name ON organizations(name);
                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_organizations_type ON organizations(type);
                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_organizations_role ON organizations(role);
                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_organizations_provider_type ON organizations(provider_type);
                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_organizations_recipient_type ON organizations(recipient_type);
                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_organizations_source_type ON organizations(source_type);
                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_organizations_monitoring_status ON organizations(monitoring_status);
                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_organizations_ai_relevance ON organizations(ai_relevance_score);
                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_organizations_africa_relevance ON organizations(africa_relevance_score);
                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                        -- Junction table for organization geographic focus
                                                                                                                                                                                                                                                                                                                                        CREATE TABLE IF NOT EXISTS organization_geographic_focus (
                                                                                                                                                                                                                                                                                                                                            organization_id INTEGER REFERENCES organizations(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                geographic_scope_id INTEGER REFERENCES geographic_scopes(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                    PRIMARY KEY (organization_id, geographic_scope_id)
                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                    -- Funding types table with category distinctions
                                                                                                                                                                                                                                                                                                                                                    CREATE TABLE IF NOT EXISTS funding_types (
                                                                                                                                                                                                                                                                                                                                                        id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                            name VARCHAR(100) NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                description TEXT,
                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                        -- Enhanced funding category tracking
                                                                                                                                                                                                                                                                                                                                                                            category VARCHAR(50) CHECK (category IN ('grant', 'investment', 'prize', 'other')),
                                                                                                                                                                                                                                                                                                                                                                                requires_equity BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                    requires_repayment BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                        typical_duration_months INTEGER,
                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                    CREATE INDEX IF NOT EXISTS idx_funding_types_category ON funding_types(category);
                                                                                                                                                                                                                                                                                                                                                                                                    CREATE INDEX IF NOT EXISTS idx_funding_types_name ON funding_types(name);
                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                    -- MonitoringData table
                                                                                                                                                                                                                                                                                                                                                                                                    CREATE TABLE IF NOT EXISTS monitoring_data (
                                                                                                                                                                                                                                                                                                                                                                                                        id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                            organization_id INTEGER REFERENCES organizations(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                check_date TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                    status VARCHAR(20),
                                                                                                                                                                                                                                                                                                                                                                                                                        error_message TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                            response_time FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                    -- ScrapingConfiguration table
                                                                                                                                                                                                                                                                                                                                                                                                                                    CREATE TABLE IF NOT EXISTS scraping_configurations (
                                                                                                                                                                                                                                                                                                                                                                                                                                        id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                            organization_id INTEGER REFERENCES organizations(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                selector_type VARCHAR(50),
                                                                                                                                                                                                                                                                                                                                                                                                                                                    selector_value TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                        created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                            );
                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                            -- UserSubmission table
                                                                                                                                                                                                                                                                                                                                                                                                                                                            CREATE TABLE IF NOT EXISTS user_submissions (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    organization_id INTEGER REFERENCES organizations(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        user_id INTEGER REFERENCES community_users(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                            submission_type VARCHAR(50),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                content TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    status VARCHAR(20) DEFAULT 'pending',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -- Content Fingerprint table
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            CREATE TABLE IF NOT EXISTS content_fingerprint (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    opportunity_id INTEGER REFERENCES africa_intelligence_feed(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        title_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            semantic_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                url_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    content_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -- Validation Result table
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            CREATE TABLE IF NOT EXISTS validation_results (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    opportunity_id INTEGER REFERENCES africa_intelligence_feed(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        validator_type VARCHAR(50),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            validation_result VARCHAR(20),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                confidence_score FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    validation_notes TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Funding opportunities table with specialized properties
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE TABLE IF NOT EXISTS africa_intelligence_feed (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                title TEXT NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    description TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        source_url TEXT NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            application_url TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -- Organization relationships (both old and new)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        organization_name TEXT, -- Keep for backward compatibility
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            organization_id INTEGER REFERENCES organizations(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                provider_organization_id INTEGER REFERENCES organizations(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    recipient_organization_id INTEGER REFERENCES organizations(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -- Enhanced funding details
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                type_id INTEGER REFERENCES funding_types(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    status VARCHAR(20) DEFAULT 'open',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        funding_amount TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            amount_min FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                amount_max FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    amount_exact FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        currency VARCHAR(10) DEFAULT 'USD',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            deadline DATE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                deadline_urgency VARCHAR(10),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Grant-specific properties
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            reporting_requirements TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                grant_duration_months INTEGER,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    renewable BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        no_strings_attached BOOLEAN,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            project_based BOOLEAN DEFAULT TRUE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -- Investment-specific properties
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        equity_percentage FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            valuation_cap FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                interest_rate FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    repayment_terms TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        investor_rights TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            post_investment_support TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                expected_roi FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Community and quality features
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            community_rating NUMERIC(2,1),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                application_tips TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    submitted_by_user_id INTEGER REFERENCES community_users(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        verified BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- Performance tracking
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    view_count INTEGER DEFAULT 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        application_count INTEGER DEFAULT 0,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- Flexible categorization
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    tags JSONB,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -- Source tracking
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                source_type TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    source_name TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        search_query TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- Relevance scores
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ai_relevance_score FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        africa_relevance_score FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            funding_relevance_score FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                overall_relevance_score FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Metadata
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            content_hash TEXT UNIQUE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                raw_data JSONB,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    discovered_date TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        last_updated TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- Processing flags
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    parsed_with_ai BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        active BOOLEAN DEFAULT TRUE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- ETL Pipeline Fields
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    title_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        semantic_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            url_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -- Content classification
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        content_type VARCHAR(50) DEFAULT 'intelligence_item',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            content_classification_confidence FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                classification_method VARCHAR(50),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Validation tracking
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            validation_status VARCHAR(20) DEFAULT 'pending',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                validation_confidence_score FLOAT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    validation_flags JSONB,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        validation_notes TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            validated_at TIMESTAMP WITH TIME ZONE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                validated_by VARCHAR(50),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    requires_human_review BOOLEAN DEFAULT TRUE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -- Module tracking
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ingestion_module VARCHAR(50),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    processing_id VARCHAR(50),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        processing_metadata JSONB,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- Multilingual support
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    detected_language VARCHAR(5) DEFAULT 'en',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        translation_status JSONB,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            is_multilingual BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -- Additional fields for equity focus
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        equity_focus_details JSONB,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            women_focus BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                underserved_focus BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    youth_focus BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -- Additional fields for geographic and AI domain focus
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                eligibility_criteria JSONB,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ai_domains JSONB,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        geographic_scopes JSONB
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Indexes for intelligence feed
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_organization ON africa_intelligence_feed(organization_id);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_provider_org ON africa_intelligence_feed(provider_organization_id);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_recipient_org ON africa_intelligence_feed(recipient_organization_id);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_type ON africa_intelligence_feed(type_id);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_status ON africa_intelligence_feed(status);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_currency ON africa_intelligence_feed(currency);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_community_rating ON africa_intelligence_feed(community_rating);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_content_type ON africa_intelligence_feed(content_type);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_validation_status ON africa_intelligence_feed(validation_status);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_ingestion_module ON africa_intelligence_feed(ingestion_module);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_processing_id ON africa_intelligence_feed(processing_id);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_title_hash ON africa_intelligence_feed(title_hash);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_semantic_hash ON africa_intelligence_feed(semantic_hash);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_url_hash ON africa_intelligence_feed(url_hash);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_women_focus ON africa_intelligence_feed(women_focus);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_underserved_focus ON africa_intelligence_feed(underserved_focus);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE INDEX IF NOT EXISTS idx_africa_intelligence_feed_youth_focus ON africa_intelligence_feed(youth_focus);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Junction tables for many-to-many relationships
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE TABLE IF NOT EXISTS intelligence_item_ai_domains (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            intelligence_item_id INTEGER REFERENCES africa_intelligence_feed(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ai_domain_id INTEGER REFERENCES ai_domains(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    PRIMARY KEY (intelligence_item_id, ai_domain_id)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    CREATE TABLE IF NOT EXISTS intelligence_item_geographic_scopes (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        intelligence_item_id INTEGER REFERENCES africa_intelligence_feed(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            geographic_scope_id INTEGER REFERENCES geographic_scopes(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                PRIMARY KEY (intelligence_item_id, geographic_scope_id)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- Insert some initial data for testing
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                INSERT INTO funding_types (name, category, requires_equity, requires_repayment) VALUES
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ('Research Grant', 'grant', FALSE, FALSE),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ('Seed Investment', 'investment', TRUE, FALSE),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ('Innovation Prize', 'prize', FALSE, FALSE),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ('Venture Capital', 'investment', TRUE, FALSE),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ('Convertible Note', 'investment', TRUE, TRUE);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- Success message
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                SELECT 'Database schema created successfully!' as message;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- Reorder table creation to ensure references exist before being used
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- 1. Create base tables first
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                CREATE TABLE IF NOT EXISTS health_check (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        status VARCHAR(50) DEFAULT 'OK',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            checked_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            CREATE TABLE IF NOT EXISTS geographic_scopes (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    name TEXT NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        code VARCHAR(10),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            region TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                description TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        CREATE TABLE IF NOT EXISTS ai_domains (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                name TEXT NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    description TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        parent_id INTEGER REFERENCES ai_domains(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                CREATE TABLE IF NOT EXISTS community_users (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        username VARCHAR(100) NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            email VARCHAR(255) NOT NULL UNIQUE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    CREATE TABLE IF NOT EXISTS organizations (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            name VARCHAR(300) NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                type VARCHAR(20) DEFAULT 'funder',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    role VARCHAR(20) DEFAULT 'provider',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        provider_type VARCHAR(20),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            recipient_type VARCHAR(20),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- ... rest of the organizations table remains the same
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    is_active BOOLEAN DEFAULT TRUE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            CREATE TABLE IF NOT EXISTS funding_types (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    name VARCHAR(100) NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        description TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            category VARCHAR(50) CHECK (category IN ('grant', 'investment', 'prize', 'other')),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                requires_equity BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    requires_repayment BOOLEAN DEFAULT FALSE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        typical_duration_months INTEGER,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- 2. Create africa_intelligence_feed BEFORE content_fingerprint
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                CREATE TABLE IF NOT EXISTS africa_intelligence_feed (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        title TEXT NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            description TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                source_url TEXT NOT NULL,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    application_url TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        organization_name TEXT,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            organization_id INTEGER REFERENCES organizations(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                provider_organization_id INTEGER REFERENCES organizations(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    recipient_organization_id INTEGER REFERENCES organizations(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        type_id INTEGER REFERENCES funding_types(id),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            -- ... rest of the africa_intelligence_feed table remains the same
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                last_updated TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                -- Now create content_fingerprint with a valid reference
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                CREATE TABLE IF NOT EXISTS content_fingerprint (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    id SERIAL PRIMARY KEY,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        opportunity_id INTEGER REFERENCES africa_intelligence_feed(id) ON DELETE CASCADE,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            title_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                semantic_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    url_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        content_hash VARCHAR(64),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                );''